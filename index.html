<!doctype html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <title>ALPINE AWARENESS MAP</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <script src="data/OEBB_NETWORK_EDGES_2.js"></script>
    <script src="data/strecken_polyline_3.js"></script>

    <style>
        html, body, #map { 
            width: 100%; 
            height: 100%; 
            padding: 0; 
            margin: 0; 
            background: #f0f0f0; /* Damit wir sehen, dass die Seite lädt */
        }
    </style>
</head>
<body>

    <div id="map"></div>

    <script>
        // 1. Karte initialisieren
        var map = L.map('map').setView([47.26, 11.39], 8);

        // 2. Graues Hintergrund-Design
        L.tileLayer('https://basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '© OpenStreetMap © CartoDB'
        }).addTo(map);

        // 3. Gelbe Bahnlinien (OEBB)
        if (typeof json_OEBB_NETWORK_EDGES_2 !== 'undefined') {
            L.geoJson(json_OEBB_NETWORK_EDGES_2, {
                style: { color: '#f0ff2d', weight: 2, opacity: 1 }
            }).addTo(map);
        }

        // 4. Gelbe Bahnlinien (Deutschland/Strecken)
        if (typeof json_strecken_polyline_3 !== 'undefined') {
            L.geoJson(json_strecken_polyline_3, {
                style: { color: '#f0ff2d', weight: 2, opacity: 1 }
            }).addTo(map);
        }

        // 5. Camps aus der CSV laden (für deine Kollegen)
        fetch('camps.csv')
            .then(res => res.text())
            .then(csvText => {
                Papa.parse(csvText, {
                    header: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        results.data.forEach(function(row) {
                            if(row.lat && row.lon) {
                                // Hier schauen wir nach dem Typ für das Icon
                                let iconPath = 'markers/default.svg';
                                if(row.typ === 'Bike') iconPath = 'markers/bike.svg';
                                if(row.typ === 'Climb') iconPath = 'markers/climb.svg';
                                if(row.typ === 'Snow') iconPath = 'markers/snow.svg';

                                var customIcon = L.icon({
                                    iconUrl: iconPath,
                                    iconSize: [30, 30],
                                    iconAnchor: [15, 30]
                                });

                                L.marker([parseFloat(row.lat), parseFloat(row.lon)], {icon: customIcon})
                                 .addTo(map)
                                 .bindPopup('<b>' + row.name + '</b><br>Typ: ' + row.typ);
                            }
                        });
                    }
                });
            })
            .catch(err => console.log("CSV Hinweis: Noch keine camps.csv Datei gefunden."));
    </script>
</body>
</html>
