<!doctype html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <title>ALPINE AWARENESS MAP</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <script src="data/OEBB_NETWORK_EDGES_2.js"></script>
    <script src="data/strecken_polyline_3.js"></script>

    <style>
        html, body, #map { 
            width: 100%; 
            height: 100%; 
            padding: 0; 
            margin: 0; 
            background: #f0f0f0; /* Damit wir sehen, dass die Seite lädt */
        }
    </style>
</head>
<body>

    <div id="map"></div>

    <script>
        // 1. Karte initialisieren
        var map = L.map('map').setView([47.26, 11.39], 8);

        // 2. Graues Hintergrund-Design
        L.tileLayer('https://basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '© OpenStreetMap © CartoDB'
        }).addTo(map);

        // 3. Gelbe Bahnlinien (OEBB)
        if (typeof json_OEBB_NETWORK_EDGES_2 !== 'undefined') {
            L.geoJson(json_OEBB_NETWORK_EDGES_2, {
                style: { color: '#f0ff2d', weight: 2, opacity: 1 }
            }).addTo(map);
        }

        // 4. Gelbe Bahnlinien (Deutschland/Strecken)
        if (typeof json_strecken_polyline_3 !== 'undefined') {
            L.geoJson(json_strecken_polyline_3, {
                style: { color: '#f0ff2d', weight: 2, opacity: 1 }
            }).addTo(map);
        }

        // 5. Camps aus der CSV laden (für deine Kollegen)
        // Dein Google Sheets Link
const googleSheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRgubvpjQe4h8QkLTlO3KojadPfkRtW7LbmIVEOwPso4Pvp6dF_fCSF0XRHnTQso9FcC_0xHtWg-Vx3/pub?gid=0&single=true&output=csv';

fetch(googleSheetUrl)
    .then(res => res.text())
    .then(csvText => {
        Papa.parse(csvText, {
            header: true,
            skipEmptyLines: true,
            complete: function(results) {
                results.data.forEach(function(row) {
                    // Wir brauchen mindestens Name, Breitengrad (lat) und Längengrad (lon)
                    if(row.name && row.lat && row.lon) {
                        
                        // Typ auslesen und Leerzeichen entfernen (z.B. " Bike " -> "Bike")
                        let typeClean = row.typ ? row.typ.trim() : 'default';

                        // Icon-Zuordnung (Die Dateien müssen bike.svg, climb.svg, snow.svg heißen)
                        let iconPath = 'markers/default.svg';
                        if(typeClean === 'Bike')  iconPath = 'markers/bike.svg';
                        if(typeClean === 'Climb') iconPath = 'markers/climb.svg';
                        if(typeClean === 'Snow')  iconPath = 'markers/snow.svg';

                        const customIcon = L.icon({
                            iconUrl: iconPath,
                            iconSize: [32, 32],      // Größe der Icons auf der Karte
                            iconAnchor: [16, 32],    // Punkt des Icons, der auf der Koordinate liegt
                            popupAnchor: [0, -32]    // Wo das Infofenster aufpoppt
                        });

                        // Marker zur Karte hinzufügen
                        L.marker([parseFloat(row.lat), parseFloat(row.lon)], {icon: customIcon})
                         .addTo(map)
                         .bindPopup('<b>' + row.name + '</b><br>Kategorie: ' + typeClean);
                    }
                });
            }
        });
    })
    .catch(err => console.error("Fehler beim Laden vom Google Sheet:", err));
    </script>
</body>
</html>
